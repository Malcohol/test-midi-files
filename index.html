<!DOCTYPE html>
<html lang=en>
<head>
<title>Test MIDI Files</title>
<script src="node_modules/jzz/javascript/JZZ.js"></script>
<script src="node_modules/jzz-synth-tiny/javascript/JZZ.synth.Tiny.js"></script>
<script src="node_modules/jzz-midi-smf/javascript/JZZ.midi.SMF.js"></script>
<script src="node_modules/jzz-gui-Player/javascript/JZZ.gui.Player.js"></script>
<style>
.half { width:50%; float:left; }
.title { font-size:x-large; font-weight:bold; }
.author { font-size:small; font-style:italic; }
.red { color:#d00; font-weight:bold; }
#log { height:20em; overflow-x:auto; margin-right:2em; white-space:pre-wrap; }
</style>
</head>

<body>
<h1>Test MIDI Files</h1>
<div id=content>Please enable JavaScript!</div>
<br clear=left>
<p><a href=https://jazz-soft.net>https://jazz-soft.net</a></p>
<script>
var content = document.getElementById('content');
content.innerHTML = 'Please run `<tt>npm install</tt>` !';
JZZ.synth.Tiny.register('Web Audio');
content.innerHTML = '\
<div><span id=player></span> <span id=reset></span></div>\
<div><span class=half>\
<pre id=log></pre>\
</span>\
<span class=half>\
-\
</span>\
</div>\
';
var text = [];
var log = document.getElementById('log');
printLog('Please select a file...');

var player = JZZ.gui.Player({ at: 'player', file: true, loop: false, sndoff: false });
player.onLoad = showInfo;
player.onPlay = clearLog;
player.connect(function(msg) {
  if (msg.ff == 1) printLog(msg.dd);
  if (msg.ff == 2) printLog('<span class=author>(' + escape(msg.dd) + ')</span>\n');
  if (msg.ff == 3) printLog('<span class=title>' + escape(msg.dd) + '</span>');
  console.log(msg.toString());
});

function clearLog() {
  text = [];
  log.innerHTML = '';
}
function escape(s) { return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }
function printLog(s) {
  text.push(s);
  log.innerHTML = text.join('\n');
  log.scrollTop = log.scrollHeight;
}
function showInfo(smf) {
  text = [];
  var i, ff1, ff2, ff3;
  var track = smf[0];
  for (i = 0; i < track.length; i++) {
    if (track[i].ff == 1 && !ff1) {
      ff1 = true;
      text.push(escape(track[i].dd));
    }
    if (track[i].ff == 2 && !ff2) {
      ff2 = true;
      text.push('<span class=author>(' + escape(track[i].dd) + ')</span>\n');
    }
    if (track[i].ff == 3 && !ff3) {
      ff3 = true;
      text.push('<span class=title>' + escape(track[i].dd) + '</span>');
    }
  }
  log.innerHTML = text.join('\n');
  log.scrollTop = log.scrollHeight;
}

// Reset button
var reset0 = document.createElement('div');
reset0.style.display = 'inline-block';
reset0.style.position = 'relative';
reset0.style.boxSizing = 'content-box';
reset0.style.margin = '0px';
reset0.style.padding = '0px';
reset0.style.borderStyle = 'none';
reset0.style.backgroundColor = '#888';
reset0.style.width = '40px';
reset0.style.height = '40px';
reset = document.createElement('div');
reset.style.display = 'inline-block';
reset.style.position = 'absolute';
reset.style.boxSizing = 'content-box';
reset.style.top = '8px';
reset.style.left = '8px';
reset.style.margin = '0';
reset.style.padding = '2px';
reset.style.borderStyle = 'solid';
reset.style.borderWidth = '1px';
reset.style.borderColor = '#ccc';
reset.style.backgroundColor = '#aaa';
reset.style.lineHeight = '0';
reset.style.lineSpasing = '0';
reset.style.width = '18px';
reset.style.height = '18px';
reset.title = 'reset';
reset.innerHTML = '<svg height="18" viewBox="0 0 24 24" width="18"><path d="M12 3c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1s1-.45 1-1V4c0-.55-.45-1-1-1zm5.14 2.86c-.39.39-.38 1-.01 1.39 1.13 1.2 1.83 2.8 1.87 4.57.09 3.83-3.08 7.13-6.91 7.17C8.18 19.05 5 15.9 5 12c0-1.84.71-3.51 1.87-4.76.37-.39.37-1-.01-1.38-.4-.4-1.05-.39-1.43.02C3.98 7.42 3.07 9.47 3 11.74c-.14 4.88 3.83 9.1 8.71 9.25 5.1.16 9.29-3.93 9.29-9 0-2.37-.92-4.51-2.42-6.11-.38-.41-1.04-.42-1.44-.02z"/></svg>';
reset.firstChild.style.fill = '#d00';
reset0.appendChild(reset);
document.getElementById('reset').appendChild(reset0);
reset.addEventListener('click', function() {
  if (player.connected()) {
    player.reset(); // send the ff -- Reset message
    printLog('<span class=red>Reset: ' + escape(player.connected()) + '</span>');
  }
});
</script>

</body>
</html>
